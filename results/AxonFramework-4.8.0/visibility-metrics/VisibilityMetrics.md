# Visibility Metrics for Java with Neo4j
<br>  

### References
- [Visibility Metrics and the Importance of Hiding Things](https://dzone.com/articles/visibility-metrics-and-the-importance-of-hiding-th)
- [Calculate metrics](https://101.jqassistant.org/calculate-metrics/index.html)
- [Controlling Access to Members of a Class](https://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html)
- [py2neo](https://py2neo.org/2021.1/)





## Artifacts

### Table 1

- List all the artifacts this notebook is based on




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>artifactName</th>
      <th>packages</th>
      <th>types</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>axon-test-4.8.0.jar</td>
      <td>8</td>
      <td>87</td>
    </tr>
    <tr>
      <th>1</th>
      <td>axon-disruptor-4.8.0.jar</td>
      <td>1</td>
      <td>22</td>
    </tr>
    <tr>
      <th>2</th>
      <td>axon-modelling-4.8.0.jar</td>
      <td>10</td>
      <td>150</td>
    </tr>
    <tr>
      <th>3</th>
      <td>axon-configuration-4.8.0.jar</td>
      <td>1</td>
      <td>39</td>
    </tr>
    <tr>
      <th>4</th>
      <td>axon-eventsourcing-4.8.0.jar</td>
      <td>9</td>
      <td>130</td>
    </tr>
    <tr>
      <th>5</th>
      <td>axon-messaging-4.8.0.jar</td>
      <td>64</td>
      <td>762</td>
    </tr>
  </tbody>
</table>
</div>



## Relative Visibility Of Types

A Java class or interface may be declared with the modifier public, in which case it is visible to all classes everywhere. If a class or interface has no modifier (the default, also known as package-private), it is visible only within its own package.

The relative visibility is the number of inner components that are visible outside (public) divided by the number of all types:

$$ relative visibility = \frac{public\:types}{all\:types} $$

Using package protected types is one of many ways to improve encapsulation and implementation detail hiding.

### How to apply the results

The relative visibility is between zero (all types are package protected) and one (all types are public). A value lower than one means that there are types that are declared package protected. The lower the value is, the better implementation details are hidden. 

Non public classes can't be accessed from another package so they can be changed without affecting code in other packages. They clearly indicate functionality that only belongs to one package. This also motivates to use more classes and to split up code into smaller pieces with a single responsibility and reason to change.

### Table 1

- Show relative visibility statistics aggregated for all packages per artifact 




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>artifact</th>
      <th>all</th>
      <th>public</th>
      <th>min</th>
      <th>max</th>
      <th>average</th>
      <th>percentile25</th>
      <th>percentile50</th>
      <th>percentile75</th>
      <th>percentile90</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>axon-configuration-4.8.0</td>
      <td>39</td>
      <td>26</td>
      <td>0.666667</td>
      <td>0.666667</td>
      <td>0.666667</td>
      <td>0.666667</td>
      <td>0.666667</td>
      <td>0.666667</td>
      <td>0.666667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>axon-disruptor-4.8.0</td>
      <td>22</td>
      <td>9</td>
      <td>0.409091</td>
      <td>0.409091</td>
      <td>0.409091</td>
      <td>0.409091</td>
      <td>0.409091</td>
      <td>0.409091</td>
      <td>0.409091</td>
    </tr>
    <tr>
      <th>2</th>
      <td>axon-eventsourcing-4.8.0</td>
      <td>130</td>
      <td>95</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>0.769159</td>
      <td>0.612903</td>
      <td>0.785714</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>axon-messaging-4.8.0</td>
      <td>762</td>
      <td>623</td>
      <td>0.100000</td>
      <td>1.000000</td>
      <td>0.866241</td>
      <td>0.750000</td>
      <td>0.973684</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>axon-modelling-4.8.0</td>
      <td>150</td>
      <td>129</td>
      <td>0.500000</td>
      <td>1.000000</td>
      <td>0.805873</td>
      <td>0.737500</td>
      <td>0.813187</td>
      <td>0.895588</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>axon-test-4.8.0</td>
      <td>87</td>
      <td>65</td>
      <td>0.473684</td>
      <td>1.000000</td>
      <td>0.781086</td>
      <td>0.650000</td>
      <td>0.775000</td>
      <td>0.968750</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>



### Table 2

- List the top 40 packages and their artifact with the highest relative visibility




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>artifactName</th>
      <th>fullQualifiedPackageName</th>
      <th>packageName</th>
      <th>publicTypes</th>
      <th>allTypes</th>
      <th>relativeVisibility</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>axon-modelling-4.8.0</td>
      <td>org.axonframework.modelling.saga</td>
      <td>saga</td>
      <td>30</td>
      <td>30</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>axon-eventsourcing-4.8.0</td>
      <td>org.axonframework.eventsourcing.eventstore.jdb...</td>
      <td>statements</td>
      <td>15</td>
      <td>15</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.serialization.upcasting.event</td>
      <td>event</td>
      <td>12</td>
      <td>12</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.lifecycle</td>
      <td>lifecycle</td>
      <td>10</td>
      <td>10</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>axon-eventsourcing-4.8.0</td>
      <td>org.axonframework.eventsourcing.conflictresolu...</td>
      <td>conflictresolution</td>
      <td>9</td>
      <td>9</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.common.property</td>
      <td>property</td>
      <td>9</td>
      <td>9</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.messaging.interceptors</td>
      <td>interceptors</td>
      <td>8</td>
      <td>8</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.messaging.responsetypes</td>
      <td>responsetypes</td>
      <td>8</td>
      <td>8</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.commandhandling.distributed....</td>
      <td>commandfilter</td>
      <td>7</td>
      <td>7</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.serialization.json</td>
      <td>json</td>
      <td>7</td>
      <td>7</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.tokenstore</td>
      <td>tokenstore</td>
      <td>7</td>
      <td>7</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.serialization.xml</td>
      <td>xml</td>
      <td>7</td>
      <td>7</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.tracing.attributes</td>
      <td>attributes</td>
      <td>6</td>
      <td>6</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.deadline.dbscheduler</td>
      <td>dbscheduler</td>
      <td>6</td>
      <td>6</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.scheduling.dbs...</td>
      <td>dbscheduler</td>
      <td>6</td>
      <td>6</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.scheduling.quartz</td>
      <td>quartz</td>
      <td>6</td>
      <td>6</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.serialization.upcasting</td>
      <td>upcasting</td>
      <td>6</td>
      <td>6</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.serialization.converters</td>
      <td>converters</td>
      <td>5</td>
      <td>5</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.gateway</td>
      <td>gateway</td>
      <td>5</td>
      <td>5</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.queryhandling.registration</td>
      <td>registration</td>
      <td>5</td>
      <td>5</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>axon-test-4.8.0</td>
      <td>org.axonframework.test.eventscheduler</td>
      <td>eventscheduler</td>
      <td>5</td>
      <td>5</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.commandhandling.callbacks</td>
      <td>callbacks</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.messaging.correlation</td>
      <td>correlation</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.deadline.jobrunr</td>
      <td>jobrunr</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.common.jpa</td>
      <td>jpa</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.tokenstore.jpa</td>
      <td>jpa</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>26</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.common.legacyjpa</td>
      <td>legacyjpa</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.deadline.quartz</td>
      <td>quartz</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>28</th>
      <td>axon-test-4.8.0</td>
      <td>org.axonframework.test.deadline</td>
      <td>deadline</td>
      <td>4</td>
      <td>4</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>29</th>
      <td>axon-eventsourcing-4.8.0</td>
      <td>org.axonframework.eventsourcing.snapshotting</td>
      <td>snapshotting</td>
      <td>3</td>
      <td>3</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>30</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.scheduling.job...</td>
      <td>jobrunr</td>
      <td>3</td>
      <td>3</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>31</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.scheduling</td>
      <td>scheduling</td>
      <td>3</td>
      <td>3</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>32</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.util</td>
      <td>util</td>
      <td>3</td>
      <td>3</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>33</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.tokenstore.leg...</td>
      <td>legacyjpa</td>
      <td>2</td>
      <td>2</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>34</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.messaging.interceptors.legac...</td>
      <td>legacyvalidation</td>
      <td>2</td>
      <td>2</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>35</th>
      <td>axon-modelling-4.8.0</td>
      <td>org.axonframework.modelling.command.legacyjpa</td>
      <td>legacyjpa</td>
      <td>2</td>
      <td>2</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>36</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.common.digest</td>
      <td>digest</td>
      <td>1</td>
      <td>1</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>37</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.interceptors</td>
      <td>interceptors</td>
      <td>1</td>
      <td>1</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>38</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.common.io</td>
      <td>io</td>
      <td>1</td>
      <td>1</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>39</th>
      <td>axon-test-4.8.0</td>
      <td>org.axonframework.test.matchers</td>
      <td>matchers</td>
      <td>23</td>
      <td>24</td>
      <td>0.958333</td>
    </tr>
    <tr>
      <th>40</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.messaging.deadletter</td>
      <td>deadletter</td>
      <td>18</td>
      <td>19</td>
      <td>0.947368</td>
    </tr>
    <tr>
      <th>41</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.deadletter.jdbc</td>
      <td>jdbc</td>
      <td>13</td>
      <td>14</td>
      <td>0.928571</td>
    </tr>
    <tr>
      <th>42</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.commandhandling.distributed</td>
      <td>distributed</td>
      <td>24</td>
      <td>26</td>
      <td>0.923077</td>
    </tr>
    <tr>
      <th>43</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.messaging</td>
      <td>messaging</td>
      <td>32</td>
      <td>35</td>
      <td>0.914286</td>
    </tr>
    <tr>
      <th>44</th>
      <td>axon-modelling-4.8.0</td>
      <td>org.axonframework.modelling.saga.repository.jdbc</td>
      <td>jdbc</td>
      <td>9</td>
      <td>10</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>45</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.commandhandling</td>
      <td>commandhandling</td>
      <td>26</td>
      <td>29</td>
      <td>0.896552</td>
    </tr>
    <tr>
      <th>46</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.tokenstore.jdbc</td>
      <td>jdbc</td>
      <td>8</td>
      <td>9</td>
      <td>0.888889</td>
    </tr>
    <tr>
      <th>47</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.eventhandling.deadletter.jpa</td>
      <td>jpa</td>
      <td>8</td>
      <td>9</td>
      <td>0.888889</td>
    </tr>
    <tr>
      <th>48</th>
      <td>axon-modelling-4.8.0</td>
      <td>org.axonframework.modelling.command</td>
      <td>command</td>
      <td>45</td>
      <td>51</td>
      <td>0.882353</td>
    </tr>
    <tr>
      <th>49</th>
      <td>axon-messaging-4.8.0</td>
      <td>org.axonframework.common</td>
      <td>common</td>
      <td>24</td>
      <td>28</td>
      <td>0.857143</td>
    </tr>
  </tbody>
</table>
</div>


